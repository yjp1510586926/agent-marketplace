# Web3 智能体任务平台 - 需求差距分析与任务拆解

> **文档说明**：本文档基于 PRD 文档与当前项目实现的对比分析，按模块拆解为小颗粒度开发任务。
>
> **状态标识**：
>
> - ⬜ 待开发（尚未实现）
> - 🟨 部分实现（UI 骨架存在，但核心逻辑缺失）
> - ✅ 已实现

---

## 📊 差距分析总览

| 模块       | PRD 需求                                | 当前状态    | 差距评估         |
| ---------- | --------------------------------------- | ----------- | ---------------- |
| 智能合约   | 任务托管、佣金分账、Aave 集成、DAO 治理 | ⬜ 未部署   | 核心缺失         |
| 任务撮合   | 完整任务生命周期管理                    | 🟨 UI 骨架  | 逻辑层缺失       |
| Agent 管理 | 链上身份、等级体系、历史记录            | 🟨 UI 骨架  | 无合约交互       |
| 理财集成   | Aave 存/借/赎回/管理费                  | 🟨 静态页面 | 无真实 Aave 对接 |
| DAO 治理   | 提案/投票/仲裁/执行                     | 🟨 UI Mock  | 无链上治理       |
| 账单财务   | 链上账单、签名发票、运营看板            | 🟨 部分 UI  | 无链上数据       |
| 钱包集成   | MetaMask/WalletConnect 实际交易         | 🟨 仅连接   | 无实际交易       |
| 多语言     | 中英双语适配                            | ⬜ 仅中文   | 需要 i18n        |

---

## 🔧 一、智能合约层（核心依赖）

### 1.1 任务托管合约 (TaskEscrow.sol)

| 任务 ID | 任务名称                            | 优先级 | 预估工时 | 状态 |
| ------- | ----------------------------------- | ------ | -------- | ---- |
| SC-001  | 创建任务托管合约基础结构            | P0     | 8h       | ⬜   |
| SC-002  | 实现任务创建与资金托管逻辑          | P0     | 8h       | ⬜   |
| SC-003  | 实现 Agent 承接任务逻辑             | P0     | 4h       | ⬜   |
| SC-004  | 实现任务交付与验收流程              | P0     | 6h       | ⬜   |
| SC-005  | 实现佣金计算与自动分账              | P0     | 6h       | ⬜   |
| SC-006  | 实现任务取消与退款机制              | P1     | 4h       | ⬜   |
| SC-007  | 实现多代币支持（ETH/USDT/USDC/DAI） | P1     | 6h       | ⬜   |
| SC-008  | 编写合约单元测试                    | P0     | 8h       | ⬜   |
| SC-009  | 部署合约到测试网（Sepolia）         | P0     | 2h       | ⬜   |

#### SC-001 详细需求

```
功能：创建任务托管合约基础结构
包含：
- 任务数据结构定义（id, title, budget, employer, agent, status, deadline）
- 合约状态变量（taskCounter, tasks mapping, platformWallet, commissionRate）
- 事件定义（TaskCreated, TaskAssigned, TaskCompleted, TaskDisputed）
- 权限控制（onlyEmployer, onlyAgent, onlyPlatform）
验收标准：
- 合约可编译通过
- 基础结构测试覆盖
```

---

### 1.2 Agent 注册合约 (AgentRegistry.sol)

| 任务 ID | 任务名称                  | 优先级 | 预估工时 | 状态 |
| ------- | ------------------------- | ------ | -------- | ---- |
| SC-010  | 创建 Agent 注册合约       | P0     | 6h       | ⬜   |
| SC-011  | 实现 Agent 质押与等级机制 | P1     | 6h       | ⬜   |
| SC-012  | 实现 Agent 评分系统       | P1     | 4h       | ⬜   |
| SC-013  | 实现技能标签链上存储      | P2     | 4h       | ⬜   |

---

### 1.3 DAO 治理合约 (DAOGovernance.sol)

| 任务 ID | 任务名称                 | 优先级 | 预估工时 | 状态 |
| ------- | ------------------------ | ------ | -------- | ---- |
| SC-020  | 创建治理代币合约 ($WAG)  | P1     | 4h       | ⬜   |
| SC-021  | 创建提案合约             | P1     | 8h       | ⬜   |
| SC-022  | 实现投票机制（快照投票） | P1     | 6h       | ⬜   |
| SC-023  | 实现仲裁流程合约         | P1     | 8h       | ⬜   |
| SC-024  | 实现仲裁池质押与奖励分配 | P2     | 6h       | ⬜   |

---

### 1.4 Aave 集成合约 (AaveIntegration.sol)

| 任务 ID | 任务名称                   | 优先级 | 预估工时 | 状态 |
| ------- | -------------------------- | ------ | -------- | ---- |
| SC-030  | 创建 Aave 适配层合约       | P1     | 8h       | ⬜   |
| SC-031  | 实现一键存入 Aave 逻辑     | P1     | 6h       | ⬜   |
| SC-032  | 实现 Aave 资产赎回         | P1     | 4h       | ⬜   |
| SC-033  | 实现平台管理费抽取（0.5%） | P2     | 4h       | ⬜   |
| SC-034  | 实现自动收益转存功能       | P2     | 6h       | ⬜   |

---

## 🌐 二、前端服务层

### 2.1 合约交互服务 (services/contracts/)

| 任务 ID | 任务名称                                    | 优先级 | 预估工时 | 状态 |
| ------- | ------------------------------------------- | ------ | -------- | ---- |
| FE-001  | 创建合约 ABI 配置文件                       | P0     | 2h       | ⬜   |
| FE-002  | 创建任务合约交互 Hook (useTaskContract)     | P0     | 6h       | ⬜   |
| FE-003  | 创建 Agent 合约交互 Hook (useAgentContract) | P0     | 4h       | ⬜   |
| FE-004  | 创建治理合约交互 Hook (useGovernance)       | P1     | 4h       | ⬜   |
| FE-005  | 创建 Aave 交互 Hook (useAaveProtocol)       | P1     | 6h       | ⬜   |
| FE-006  | 创建交易状态管理 Hook (useTxStatus)         | P0     | 4h       | ⬜   |

#### FE-002 详细需求

```
功能：创建任务合约交互 Hook
包含：
- createTask(formData) - 创建任务并托管资金
- applyForTask(taskId) - Agent 申请任务
- assignAgent(taskId, agentAddress) - 雇主分配任务
- submitDelivery(taskId, proofHash) - 提交交付物
- approveDelivery(taskId) - 验收通过
- raiseDispute(taskId, reason) - 发起争议
- getTaskDetails(taskId) - 获取任务详情
- getUserTasks(address) - 获取用户任务列表
返回值：
- 交易状态（pending/success/error）
- 交易 hash
- 错误信息
验收标准：
- 可在测试网完成完整任务流程
- 交易提示用户友好
```

---

### 2.2 全局状态管理

| 任务 ID | 任务名称                               | 优先级 | 预估工时 | 状态 |
| ------- | -------------------------------------- | ------ | -------- | ---- |
| FE-010  | 搭建全局状态管理（Zustand/Redux）      | P0     | 4h       | ⬜   |
| FE-011  | 创建用户状态 Store（钱包、余额、角色） | P0     | 4h       | ⬜   |
| FE-012  | 创建任务状态 Store                     | P0     | 3h       | ⬜   |
| FE-013  | 创建通知/Toast 状态管理                | P1     | 2h       | ⬜   |

---

## 📄 三、页面功能完善

### 3.1 任务市场页 (Marketplace.tsx)

| 任务 ID | 任务名称                            | 优先级 | 预估工时 | 状态 |
| ------- | ----------------------------------- | ------ | -------- | ---- |
| PG-001  | 接入真实任务列表数据（合约 + 缓存） | P0     | 6h       | 🟨   |
| PG-002  | 实现任务筛选功能（状态/技能/预算）  | P1     | 4h       | 🟨   |
| PG-003  | 实现任务搜索功能                    | P2     | 3h       | ⬜   |
| PG-004  | 实现分页/无限滚动加载               | P2     | 3h       | ⬜   |
| PG-005  | 展示实时平台统计数据                | P1     | 4h       | 🟨   |
| PG-006  | 实现任务卡片点击跳转详情            | P0     | 1h       | ✅   |

#### PG-001 详细需求

```
功能：接入真实任务列表数据
当前状态：使用 Mock 静态数据
目标：
1. 从链上合约读取任务列表
2. 实现链下缓存机制（IndexedDB/localStorage）
3. 支持增量更新（监听合约事件）
4. 显示真实预算、佣金比例、已申请人数
依赖：SC-001, FE-002
验收标准：
- 任务列表来自链上
- 刷新页面数据正确加载
- 新任务发布后列表自动更新
```

---

### 3.2 任务发布页 (CreateTask.tsx)

| 任务 ID | 任务名称                          | 优先级 | 预估工时 | 状态 |
| ------- | --------------------------------- | ------ | -------- | ---- |
| PG-010  | 接入合约创建任务（钱包签名+托管） | P0     | 6h       | 🟨   |
| PG-011  | 实现佣金计算实时预览              | P0     | 2h       | ✅   |
| PG-012  | 实现代币余额校验                  | P0     | 2h       | ⬜   |
| PG-013  | 添加交易确认/进度弹窗             | P0     | 3h       | ⬜   |
| PG-014  | 实现任务描述富文本编辑            | P2     | 4h       | ⬜   |
| PG-015  | 添加表单校验与错误提示            | P1     | 2h       | ⬜   |

---

### 3.3 任务详情页 (TaskDetail.tsx)

| 任务 ID | 任务名称                     | 优先级 | 预估工时 | 状态 |
| ------- | ---------------------------- | ------ | -------- | ---- |
| PG-020  | 接入真实任务详情数据         | P0     | 4h       | 🟨   |
| PG-021  | 实现 Agent 申请任务功能      | P0     | 4h       | 🟨   |
| PG-022  | 实现雇主选人/分配任务功能    | P0     | 4h       | ⬜   |
| PG-023  | 实现任务进度展示（状态流转） | P1     | 4h       | ⬜   |
| PG-024  | 实现交付物提交功能           | P1     | 6h       | ⬜   |
| PG-025  | 实现验收/拒绝功能            | P1     | 4h       | ⬜   |
| PG-026  | 实现一键发起争议功能         | P1     | 4h       | ⬜   |
| PG-027  | 展示佣金明细（费用分解）     | P0     | 2h       | ✅   |
| PG-028  | 展示雇主/Agent 历史评分      | P2     | 3h       | ⬜   |

---

### 3.4 Agent 注册页 (AgentRegister.tsx)

| 任务 ID | 任务名称                   | 优先级 | 预估工时 | 状态 |
| ------- | -------------------------- | ------ | -------- | ---- |
| PG-030  | 接入合约完成链上注册       | P0     | 6h       | 🟨   |
| PG-031  | 实现质押支付流程           | P0     | 4h       | ⬜   |
| PG-032  | 实现服务等级选择与质押联动 | P1     | 3h       | 🟨   |
| PG-033  | 添加注册成功反馈与跳转     | P1     | 2h       | ⬜   |
| PG-034  | 实现已注册 Agent 信息展示  | P1     | 3h       | ⬜   |

---

### 3.5 金融控制台页 (Finance.tsx)

| 任务 ID | 任务名称                       | 优先级 | 预估工时 | 状态 |
| ------- | ------------------------------ | ------ | -------- | ---- |
| PG-040  | 接入 Aave 协议读取真实资产数据 | P1     | 8h       | 🟨   |
| PG-041  | 实现资产存入 Aave 功能         | P1     | 6h       | ⬜   |
| PG-042  | 实现资产从 Aave 赎回功能       | P1     | 4h       | ⬜   |
| PG-043  | 实现借贷资产功能               | P2     | 6h       | ⬜   |
| PG-044  | 展示真实年化收益率（APY）      | P1     | 3h       | 🟨   |
| PG-045  | 实现自动转存开关功能           | P2     | 4h       | 🟨   |
| PG-046  | 实现任务结算后弹窗推荐理财     | P2     | 3h       | ⬜   |
| PG-047  | 展示管理费说明与真实扣费       | P1     | 2h       | 🟨   |

---

### 3.6 DAO 治理页 (Governance.tsx)

| 任务 ID | 任务名称                   | 优先级 | 预估工时 | 状态 |
| ------- | -------------------------- | ------ | -------- | ---- |
| PG-050  | 接入链上提案列表           | P1     | 4h       | 🟨   |
| PG-051  | 实现链上投票功能           | P1     | 4h       | 🟨   |
| PG-052  | 实现创建提案功能           | P1     | 6h       | 🟨   |
| PG-053  | 实现争议仲裁发起流程       | P1     | 6h       | ⬜   |
| PG-054  | 实现委托投票权功能         | P2     | 4h       | 🟨   |
| PG-055  | 实现加入仲裁池质押功能     | P2     | 4h       | 🟨   |
| PG-056  | 展示真实投票权与 $WAG 余额 | P1     | 3h       | 🟨   |
| PG-057  | 提案详情页（新页面）       | P2     | 6h       | ⬜   |

---

### 3.7 个人中心页 (Profile.tsx)

| 任务 ID | 任务名称                                | 优先级 | 预估工时 | 状态 |
| ------- | --------------------------------------- | ------ | -------- | ---- |
| PG-060  | 接入链上账单数据                        | P0     | 6h       | 🟨   |
| PG-061  | 实现账单筛选功能（收入/理财/佣金/仲裁） | P1     | 3h       | 🟨   |
| PG-062  | 实现账单下载（PDF + 链上 hash 签名）    | P1     | 6h       | ⬜   |
| PG-063  | 接入真实任务历史                        | P0     | 4h       | 🟨   |
| PG-064  | 展示用户 Agent 资质信息                 | P1     | 3h       | ⬜   |
| PG-065  | 实现编辑个人资料功能                    | P2     | 4h       | ⬜   |

---

## 🌍 四、通用基础设施

### 4.1 国际化 (i18n)

| 任务 ID | 任务名称                        | 优先级 | 预估工时 | 状态 |
| ------- | ------------------------------- | ------ | -------- | ---- |
| INF-001 | 集成 i18n 框架（react-i18next） | P1     | 2h       | ⬜   |
| INF-002 | 提取中文文案到语言文件          | P1     | 4h       | ⬜   |
| INF-003 | 添加英文翻译                    | P1     | 4h       | ⬜   |
| INF-004 | 实现语言切换按钮                | P1     | 1h       | ⬜   |

---

### 4.2 首次使用引导

| 任务 ID | 任务名称                                  | 优先级 | 预估工时 | 状态 |
| ------- | ----------------------------------------- | ------ | -------- | ---- |
| INF-010 | 设计引导流程 UX                           | P2     | 2h       | ⬜   |
| INF-011 | 实现新用户三大入口引导（任务/Agent/理财） | P2     | 6h       | ⬜   |
| INF-012 | 实现任务发布时佣金费率说明弹窗            | P1     | 2h       | ⬜   |
| INF-013 | 实现理财风险提示弹窗                      | P1     | 2h       | ⬜   |

---

### 4.3 错误处理与反馈

| 任务 ID | 任务名称                        | 优先级 | 预估工时 | 状态 |
| ------- | ------------------------------- | ------ | -------- | ---- |
| INF-020 | 统一错误提示组件（Toast/Modal） | P0     | 3h       | ⬜   |
| INF-021 | 实现交易进度提示                | P0     | 4h       | ⬜   |
| INF-022 | 实现网络切换提示                | P1     | 2h       | ⬜   |
| INF-023 | 实现钱包余额不足提示            | P0     | 2h       | ⬜   |

---

### 4.4 链上数据索引

| 任务 ID | 任务名称                  | 优先级 | 预估工时 | 状态 |
| ------- | ------------------------- | ------ | -------- | ---- |
| INF-030 | 评估 The Graph 集成方案   | P1     | 2h       | ⬜   |
| INF-031 | 创建 Subgraph schema 定义 | P1     | 4h       | ⬜   |
| INF-032 | 部署 Subgraph 到测试网    | P1     | 4h       | ⬜   |
| INF-033 | 前端接入 GraphQL 查询     | P1     | 4h       | ⬜   |

---

## 📈 五、运营看板（PRD 要求）

| 任务 ID | 任务名称                            | 优先级 | 预估工时 | 状态 |
| ------- | ----------------------------------- | ------ | -------- | ---- |
| OPS-001 | 创建运营看板页面框架                | P2     | 4h       | ⬜   |
| OPS-002 | 展示撮合成功率与平均撮合时间        | P2     | 4h       | ⬜   |
| OPS-003 | 展示佣金收入统计                    | P2     | 3h       | ⬜   |
| OPS-004 | 展示理财资金流动与 TVL              | P2     | 4h       | ⬜   |
| OPS-005 | 展示 DAO 活跃度（提案/投票/参与率） | P2     | 4h       | ⬜   |

---

## 🚀 六、开发优先级排序（建议执行顺序）

### Phase 1: 核心链路打通 (Week 1-2)

1. SC-001 ~ SC-005：任务托管合约
2. FE-001 ~ FE-002：合约交互服务
3. PG-010, PG-001：任务发布与列表对接

### Phase 2: Agent 与任务流程 (Week 3)

4. SC-010 ~ SC-012：Agent 注册合约
5. PG-030, PG-020 ~ PG-025：Agent 注册与任务生命周期

### Phase 3: 理财与治理 (Week 4-5)

6. SC-030 ~ SC-032：Aave 集成
7. PG-040 ~ PG-042：理财页面对接
8. SC-020 ~ SC-023：DAO 治理合约
9. PG-050 ~ PG-053：治理页面对接

### Phase 4: 完善与优化 (Week 6)

10. INF-001 ~ INF-004：国际化
11. PG-060 ~ PG-062：账单与财务
12. INF-020 ~ INF-023：错误处理

---

## 📝 任务模板

```markdown
## [任务 ID] 任务标题

### 描述

任务的详细说明

### 依赖

- 依赖的其他任务 ID

### 验收标准

- [ ] 验收条件 1
- [ ] 验收条件 2

### 技术要点

- 实现注意事项
- 参考资料

### 预估工时

X 小时

### 状态

⬜ 待开发 / 🟡 开发中 / ✅ 已完成
```

---

_文档生成时间：2026-01-15_  
_基于 PRD 版本：Web3 智能体任务平台 v1.0_
